
package default_package;

import java.io.FileInputStream;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;

import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import com.tyss.optimize.common.util.CommonConstants;
import com.tyss.optimize.nlp.util.Nlp;
import com.tyss.optimize.nlp.util.NlpException;
import com.tyss.optimize.nlp.util.NlpRequestModel;
import com.tyss.optimize.nlp.util.NlpResponseModel;
import com.tyss.optimize.nlp.util.annotation.InputParam;
import com.tyss.optimize.nlp.util.annotation.InputParams;
import com.tyss.optimize.nlp.util.annotation.ReturnType;

import lombok.extern.java.Log;

public class Get_data_from_Exel implements Nlp {
	@InputParams({ @InputParam(name = "sheet", type = "java.lang.String"),
	@InputParam(name = "row", type = "java.lang.Integer"),
	@InputParam(name = "file", type = "java.lang.String"),
	@InputParam(name = "column", type = "java.lang.Integer")})
	
	@ReturnType(name = "result", type = "java.lang.String")

	@Override
	public List<String> getTestParameters() throws NlpException {
		List<String> params = new ArrayList<>();
		return params;
	}

	@Override
	public StringBuilder getTestCode() throws NlpException {
		StringBuilder sb = new StringBuilder();
		return sb;
	}

	@Override
	public NlpResponseModel execute(NlpRequestModel nlpRequestModel) throws NlpException {

		NlpResponseModel nlpResponseModel = new NlpResponseModel();
		Map<String, Object> attributes = nlpRequestModel.getAttributes();
		String Sheet = (String) attributes.get("sheet");
		Integer Rows = (Integer) attributes.get("row");
		String file = (String) attributes.get("file");
		Integer column = (Integer) attributes.get("column");
		
		LinkedList<String> data = new LinkedList<>();
		
		String res = null;
		
		try {
			FileInputStream fis = new FileInputStream(file);
			Workbook workbook = new XSSFWorkbook(fis);
			    Sheet sheet = workbook.getSheet(Sheet);
			    if (sheet == null) {
	                System.out.println("Sheet with name \"" + Sheet + "\" does not exist.");
	              
	            }
			    
			    String result = null;
			    for (int i = 1; i <= Rows; i++) {
	                Row row = sheet.getRow(i);

	                if (row != null) {
	                    Cell cell = row.getCell(column);

	                    if (cell != null) {
	                      
	                    	data.add(cell.toString().trim());
	                      
	                       result = String.join(", ", data);
	                       
	                    }
	                    
	                    else {
	                    	
	                        System.out.println("Empty cell at row " + (i + 1) + ", column " + (column + 1));
	                    }
	                }
	            }
			    
			    res = result.replace("\"", "");
			    
				nlpResponseModel.setStatus(CommonConstants.pass);
				nlpResponseModel.setMessage("Successfully extracted the data from excel");
			

		} catch (Exception e) {
			
			nlpResponseModel.setStatus(CommonConstants.fail);
			nlpResponseModel.setMessage("Failed to get excel data  "+e);
		}
		

		nlpResponseModel.getAttributes().put("result", res);
		return nlpResponseModel;
	}
	
	
	
	
	
	
	
	 public static void main(String[] args) throws NlpException {
   	  
   	  String Sheet = "File_Paths"; 
      int Rows =8;
      String file = "C:/Users/User/Downloads/OrthoFX TestData.xlsx";
      int column=1;
         
     	 
   		NlpRequestModel nlp = new NlpRequestModel();
   		Map<String, Object> attributes = nlp.getAttributes();
   		
   		attributes.put("sheet", Sheet);
   		attributes.put("row", Rows);
   		attributes.put("file", file);
   		attributes.put("column", column);
        
   		Get_data_from_Map d=new Get_data_from_Map();
   		d.execute(nlp);
   		
   	}
}